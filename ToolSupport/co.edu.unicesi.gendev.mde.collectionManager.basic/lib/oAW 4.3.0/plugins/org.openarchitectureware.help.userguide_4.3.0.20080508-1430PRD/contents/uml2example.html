<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>UML2 Example</title><link rel="stylesheet" href="../book.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="index.html" title="openArchitectureWare User Guide"><link rel="up" href="reference.html" title="Part&nbsp;II.&nbsp;Reference"><link rel="prev" href="r50.html" title="UML2 Adapter"><link rel="next" href="r52.html" title="EMF Validation Adapter"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="uml2example"></a>UML2 Example</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="uml2example.html#uml2example_setup_eclipse">Setting up Eclipse</a></span></dt><dt><span class="section"><a href="uml2example.html#uml2example_setup_project">Setting up the project</a></span></dt><dt><span class="section"><a href="uml2example.html#uml2example_create_model">Creating a UML2 Model</a></span></dt><dt><span class="section"><a href="uml2example.html#uml2example_codegen">Code generation</a></span></dt><dt><span class="section"><a href="uml2example.html#uml2example_profiles">Profile Support</a></span></dt></dl></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uml2example_setup_eclipse"></a>Setting up Eclipse</h2></div></div></div><p>Before you can use oAW with Eclipse UML2, you first have to install
    the UML2 plugins into your Eclipse installation.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uml2example_setup_project"></a>Setting up the project</h2></div></div></div><p>Create a new openArchitectureWare plugin project. You have to add
    the following dependencies to the manifest file: </p><div class="itemizedlist"><ul type="disc"><li>
           org.openarchitectureware.uml2.adapter 
        </li></ul></div><p>To tell the oAW Eclipse plugins that this project is a UML2 specific
    one, you need to specify that in the oAW preferences. Open the project
    properties, select the openArchitectureWare tab and select the UML2
    profiles metamodel. </p><div class="figure"><a name="uml2example_metamodel_config"></a><p class="title"><b>Figure&nbsp;27.&nbsp;Configure UML2 profiles metamodel</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/50_uml2example/props.gif" alt="Configure UML2 profiles metamodel"></div></div></div><p><br class="figure-break"></p><p>Note that if you want to transform an UML2 model into a normal EMF
    model, you need to add the UML2 metamodel and the EMF metamodels. The
    order of profiles is important! The UML2 profiles entry must be first in
    the list.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uml2example_create_model"></a>Creating a UML2 Model</h2></div></div></div><p>You start by defining a UML2 model, i.e. an instance of the UML2
    metamodel. In the new Java project, in the source folder, you create a
    UML2 model that you should call <code class="filename">example.uml</code>.</p><div class="figure"><a name="uml2example_create_model_1"></a><p class="title"><b>Figure&nbsp;28.&nbsp;Creating a new UML2 model</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/50_uml2example/createUMLModel.gif" alt="Creating a new UML2 model"></div></div></div><br class="figure-break"><p>You then have to select the model object. Make sure its a
    <span class="emphasis"><em>Model</em></span>, not a <span class="emphasis"><em>Profile</em></span>. </p><div class="figure"><a name="uml2example_select_modelobject"></a><p class="title"><b>Figure&nbsp;29.&nbsp;Selecting the Model object</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/50_uml2example/modelobject.gif" alt="Selecting the Model object"></div></div></div><p><br class="figure-break"></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="uml2example_modelling"></a>Modelling the content</h3></div></div></div><p>You should then build a model that looks somewhat like this:
      </p><div class="figure"><a name="uml2example_examplemodel"></a><p class="title"><b>Figure&nbsp;30.&nbsp;Example model</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/50_uml2example/exampleModel.gif" alt="Example model"></div></div></div><p><br class="figure-break"></p><p>By the way, if you rename the <code class="filename">.uml</code> file to
      <code class="filename">.ecore</code>, you can edit the model using the ecore
      editors. To inspect the model, they provide a somewhat better view, so
      you might try!</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uml2example_codegen"></a>Code generation</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="uml2example_codegen_templates"></a>Defining the templates</h3></div></div></div><p>Inside the source folder of our project, create a
      <code class="filename">templates</code> package. Inside that package folder,
      create a template file <code class="filename">Root.xpt</code> that has the
      following content. First, we define the entry template that is called
      <code class="classname">Root</code>. Since we expect a UML model element to be
      the top element to the model, we define it for
      <code class="classname">uml::Model</code>. Note the use of the
      <code class="classname">uml</code> Namespace prefix, as defined in the UML2
      metamodel. Inside that template, we iterate over all owned elements of
      the model and expand a template for the packages defined in it.</p><pre class="programlisting">&laquo;DEFINE Root FOR uml::Model&raquo;
&laquo;EXPAND PackageRoot FOREACH ownedElement&raquo;
&laquo;ENDDEFINE&raquo;</pre><p>In the package template, we again iterate over all owned elements
      and call a template that handles classes. At this point, we expect that
      only classes are in that package.</p><pre class="programlisting">&laquo;DEFINE PackageRoot FOR uml::Package&raquo;
	&laquo;EXPAND ClassRoot FOREACH ownedType&raquo;
&laquo;ENDDEFINE&raquo;</pre><p>This template handles classes. It opens a file that has the same
      name as the class, suffixed by <code class="filename">.java</code>. Into that
      file, we generate an empty class body.</p><pre class="programlisting">&laquo;DEFINE ClassRoot FOR uml::Class&raquo;
	&laquo;FILE name+".java"&raquo;
		public class &laquo;name&raquo; {}
	&laquo;ENDFILE&raquo;
&laquo;ENDDEFINE&raquo; </pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="uml2example_codegen_workflow"></a>Defining the workflow</h3></div></div></div><p>In order to generate code, we need a workflow definition. Here is
      the workflow file; you should put it into the source folder. The file
      should be generally understandable if you read the oAW EMF Example
      docs.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="ISO-8859-1"?&gt;
&lt;workflow&gt;
</pre><p>You need to setup the UML2 stuff (registering URI maps, Factories,
      etc.). This can be done declaring a bean in before of the
      <code class="classname">XmiReader</code> component:</p><pre class="programlisting">	&lt;bean class="oaw.uml2.Setup" standardUML2Setup="true"/&gt;
	&lt;component class="oaw.emf.XmiReader"&gt;
		&lt;modelFile value="example.uml"/&gt;
		&lt;outputSlot value="model"/&gt;
	&lt;/component&gt;</pre><p>The <code class="classname">XmiReader</code> reads the model and stores
      the content (a list containing the model element) in a slot named
      '<code class="varname">model</code>'. As usual, you might want to clean the target
      directory.</p><pre class="programlisting">	&lt;component id="dirCleaner"
		class="oaw.workflow.common.DirectoryCleaner"
		directories="src-gen"/&gt;</pre><p>and in the generator we also configure the EMF metamodel for oAW,
      together with the UML2 metamodel package, because the UML2 metamodel
      refers to it.</p><pre class="programlisting">	&lt;component id="generator" class="oaw.xpand2.Generator"
		skipOnErrors="true"&gt;
		&lt;metaModel class="oaw.type.emf.EmfMetaModel"&gt;
			&lt;metaModelPackage  value="org.eclipse.emf.ecore.EcorePackage"/&gt;
		&lt;/metaModel&gt;
		&lt;metaModel class="oaw.uml2.UML2MetaModel"/&gt;
		&lt;expand value="templates::Root::Root FOR model"/&gt;
		&lt;outlet path="src-gen/"&gt;
			&lt;postprocessor class="oaw.xpand2.output.JavaBeautifier"/&gt;
		&lt;/outlet&gt;
	&lt;/component&gt; </pre><p>If you run the workflow (by right clicking on the .oaw file and
      select <span class="guiicon">Run As</span> &#8594; <span class="guimenuitem">oAW workflow</span>) the two Java classes should be generated.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="uml2example_profiles"></a>Profile Support</h2></div></div></div><p>openArchitectureWare 4 is shipped with a special
    <span class="emphasis"><em>UML2Profiles</em></span> metamodel implementation. The
    implementation maps Stereotypes to Types and Tagged Values to simple
    properties. It also supports Enumerations defined in the profile and
    Stereotype hierarchies.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="uml2example_profiles_define"></a>Defining a Profile</h3></div></div></div><p>To define a profile, you can use a variety of UML2-based modelling
      tools. Assuming they do actually correctly create profile definitions
      (which is not always the case, as we had to learn painfully), creating a
      profile and exporting it correctly is straight forward.</p><p>In this section, we explain the "manual way", which is good for
      explaining what happens, but completely useless for practical use. You
      do not want to build models of realistic sizes using the mechanisms
      explained below.</p><p>You start be creating a new UML2 file (as shown above). In the
      example we will call it <code class="filename">test.profile.uml</code>. The root
      element, however, will be a <span class="emphasis"><em>Profile</em></span>, not a
      <span class="emphasis"><em>Package</em></span>. Don't forget to actually assign a name to
      the profile! It should be <code class="literal">test</code>, too.</p><p>As a child of that <span class="emphasis"><em>Profile</em></span>, you then create a
      <span class="emphasis"><em>Packaged Element Stereotype</em></span> (you will have to
      scroll a bit in the <span class="emphasis"><em>Add Child</em></span> menu....). For the
      sake of example, we will call it <code class="literal">test</code>, too. In our
      case, we want to make the stereotype be applicable to UML classes &#8211; they
      are defined as part of the UML2 metamodel. So we have to import that
      metamodel first. So what you do is to select your profile object, and
      then go to the UML2 Editor menu (in the Eclipse menu bar) and select
      <span class="emphasis"><em>Profile -&gt; Reference Metaclass</em></span>. Select
      <code class="classname">uml::Class</code>. You can then select your stereotype,
      and select <span class="emphasis"><em>Stereotype -&gt; Create Extension</em></span> from
      the UML2 Editor menu. Select <code class="classname">uml::Class</code>. This
      should lead to the following model. Save it and you are done with the
      profile definition.</p><div class="figure"><a name="uml2example_profile"></a><p class="title"><b>Figure&nbsp;31.&nbsp;Modelling a Profile</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/50_uml2example/profile.gif" alt="Modelling a Profile"></div></div></div><br class="figure-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="uml2example_profile_apply"></a>Applying the Profile</h3></div></div></div><p>To make any use of the profile, we have to apply it to some kind
      of model. To do that, we copy the <code class="filename">example.uml</code> model
      to a <code class="filename">example-profiled.uml</code>. We then open that file
      and load a resource, namely the profile we just defined. This then looks
      somewhat like this:</p><div class="figure"><a name="uml2example_profileApp1"></a><p class="title"><b>Figure&nbsp;32.&nbsp;Loading the Profile</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/50_uml2example/profileApp1.gif" alt="Loading the Profile"></div></div></div><br class="figure-break"><p>Now, to make the following stuff work, you first have to select
      the profile and select the <span class="emphasis"><em>Profile -&gt; Define</em></span>
      operation from the UML2 Editor menu. This creates all kinds of
      additional model elements, about which you should not care for the
      moment.</p><p>Now, finally, you can select your <code class="literal">cars</code> package
      (the one from the example model) and select <span class="emphasis"><em>Package -&gt;
      Apply Profile</em></span> from the UML2 Editor menu. Select your test
      profile to be applied.</p><p>For the purpose of this example, you should now apply the test
      stereotype to the <code class="classname">PersonCar</code> class. Select the
      class, and the select <span class="emphasis"><em>Element -&gt; Apply
      Stereotype</em></span> from the UML2 Editor menu. This should result in
      the following model:</p><div class="figure"><a name="uml2example_profileApp2"></a><p class="title"><b>Figure&nbsp;33.&nbsp;Defining the Profile</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/50_uml2example/profileApp2.gif" alt="Defining the Profile"></div></div></div><br class="figure-break"></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="uml2example_profiles_codegen"></a>Generating Code</h3></div></div></div><p>Note that all the stuff above was not in any way related to oAW,
      it was just the "bare bones" means of creating and applying a profile to
      a UML2 model</p><p>There are two things we have to change: The workflow
      (specifically, the configuration of the generator component) needs to
      know about the profile, and the template needs to generate different
      code if a class has the test stereotype applied. Let us look at the
      second aspect first. Here is the modified template (in
      <code class="filename">RootWithProfile.xpt</code>):</p><pre class="programlisting">&laquo;DEFINE Root FOR uml::Model&raquo;
	&laquo;EXPAND PackageRoot FOREACH (List[uml::Package])ownedElement&raquo;
&laquo;ENDDEFINE&raquo;

&laquo;DEFINE PackageRoot FOR uml::Package&raquo;
	&laquo;EXPAND ClassRoot FOREACH (List[uml::Class])ownedType&raquo;
&laquo;ENDDEFINE&raquo;

&laquo;DEFINE ClassRoot FOR uml::Class&raquo;
&laquo;FILE name+".java"&raquo;
	public class &laquo;name&raquo; {}
&laquo;ENDFILE&raquo;
&laquo;ENDDEFINE&raquo;

&laquo;DEFINE ClassRoot FOR test::test&raquo;
&laquo;FILE name+".java"&raquo;

public class &laquo;name&raquo; {} // stereotyped
&laquo;ENDFILE&raquo;
&laquo;ENDDEFINE&raquo; </pre><p>As you can see, the stereotype acts just like a type, and even the
      polymorphic dispatch between the base type
      (<code class="classname">uml::Class</code>) and the stereotype works.</p><p>Adapting the workflow file is also straight forward
      (<code class="filename">workflowWithProfile.oaw</code>), here is the modified
      generator component:</p><pre class="programlisting">&lt;component id="generator" class="oaw.xpand2.Generator"
skipOnErrors="true"&gt;
	&lt;metaModel class="oaw.type.emf.EmfMetaModel"
		metaModelPackage="org.eclipse.emf.ecore.EcorePackage"/&gt;
	&lt;metaModel class="oaw.uml2.UML2MetaModel"/&gt;
	&lt;metaModel id="profile"
		class="oaw.uml2.profile.ProfileMetaModel"&gt;
		&lt;profile value="test.profile.uml"/&gt;
	&lt;/metaModel&gt;
	&lt;expand
		value="templates::RootWithProfile::Root FOR model"/&gt;
		&lt;outlet path="src-gen"&gt;
			&lt;postprocessor class="oaw.xpand2.output.JavaBeautifier"/&gt;
 	&lt;/outlet&gt;
&lt;/component&gt;</pre><p>The only thing, we have to do is to add a new metamodel that
      references the profile we just created.</p></div></div></div></body></html>