<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>oAW Tutorial</title><link rel="stylesheet" href="../book.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.72.0"><link rel="start" href="index.html" title="openArchitectureWare User Guide"><link rel="up" href="gettingstarted.html" title="Part&nbsp;I.&nbsp;Getting Started"><link rel="prev" href="gettingstarted.html" title="Part&nbsp;I.&nbsp;Getting Started"><link rel="next" href="xtext_tutorial.html" title="Xtext Tutorial"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="chapter" lang="en"><div class="titlepage"><div><div><h2 class="title"><a name="emf_tutorial"></a>oAW Tutorial</h2></div></div></div><div class="toc"><dl><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_installing">Installing the pre-built tutorial</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_overview">Tutorial overview</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_define_metamodel">Defining an EMF metamodel</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_generate_emf_tooling">Generating the EMF tooling</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_setting_generator_project">Setting up the generator project</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_defining_sample_model">Defining an Example Data Model</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_dynamic_emf">Using Dynamic EMF</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_generating_code">Generating code from the example model</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_checking_contraints_with_check">Checking Constraints with the <span class="emphasis"><em>Check</em></span>
    Language</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_extensions">Extensions</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_integrating_recipes">Integrating Recipes</a></span></dt><dt><span class="section"><a href="emf_tutorial.html#emf_tutorial_transforming_models">Transforming Models</a></span></dt></dl></div><p>This example uses Eclipse EMF as the basis for code generation. One of
  the essential new features of openArchitectureWare 4 is EMF support. While
  not all aspects of EMF as good and nice to use as one would wish, the large
  amount of available third party tools makes EMF a good basis. Specifically,
  better tools for building EMF metamodels are available already (Xtext, GMF, etc.). To get
  a deeper understanding of EMF, we recommend that you first read the EMF
  tutorial at </p><div class="itemizedlist"><ul type="disc"><li><a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www-128.ibm.com/developerworks/library/os-ecemf1/" target="_top">http://www-128.ibm.com/developerworks/library/os-ecemf1/</a></li><li><a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www-128.ibm.com/developerworks/library/os-ecemf2/" target="_top">http://www-128.ibm.com/developerworks/library/os-ecemf2/</a></li><li><a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www-128.ibm.com/developerworks/library/os-ecemf3/" target="_top">http://www-128.ibm.com/developerworks/library/os-ecemf3/</a></li></ul></div><p> You can also run the tutorial without completely
  understanding EMF, but the tutorial might seem unnecessarily complex to
  you.</p><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_installing"></a>Installing the pre-built tutorial</h2></div></div></div><p>You need to have openArchitectureWare 4.3 installed. Please consider
    <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://www.eclipse.org/gmt/oaw/download" target="_top">http://www.eclipse.org/gmt/oaw/download</a> for
    details.</p><p>You can also install the code for the tutorial. It can be downloaded
    from the URL above, it is part of the EMF samples ZIP file. Installing the
    demos is easy: Just add the projects to your workspace. Note, that in the
    openArchitectureWare preferences (either globally for the workspace, or
    specific for the sample projects, you have to select <span class="emphasis"><em>EMF
    metamodels</em></span> for these examples to work.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_overview"></a>Tutorial overview</h2></div></div></div><p>The purpose of this tutorial is to illustrate code generation with
    openArchitectureWare from EMF models. The process, we are going to go
    through, will start by defining a metamodel (using EMF tooling), coming up
    with some example data, writing code generation templates, running the
    generator and finally adding some constraint checks.</p><p>The actual content of the example is rather trivial &#8211; we will
    generate Java classes following the JavaBean conventions. The model will
    contain entities (such as <span class="type">Person</span> or <span class="type">Vehicle</span>)
    including some attributes and relationships among them &#8211; a rather typical
    data model. From these entities in the model, we want to generate the
    Beans for implementation in Java. In a real setting, we might also want to
    generate persistence mappings, etc. We will not to this for this simple
    introduction.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_define_metamodel"></a>Defining an EMF metamodel</h2></div></div></div><p>To illustrate the metamodel, before we deal with the intricacies of
    EMF, here is the metamodel in UML: </p><div class="figure"><a name="emf_tutorial_sample_metamodel"></a><p class="title"><b>Figure&nbsp;1.&nbsp;Sample metamodel</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/metamodel.gif" alt="Sample metamodel"></div></div></div><p><br class="figure-break"></p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_creating_emf_project"></a>Creating an EMF project</h3></div></div></div><p>Create an EMF project as depicted below:</p><div class="figure"><a name="emf_tutorial_create_emf_project"></a><p class="title"><b>Figure&nbsp;2.&nbsp;Create EMF project</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_emf_project.jpg" alt="Create EMF project"></div></div></div><br class="figure-break"><p>It is important that you create an EMF project, not just a simple
      or a Java project. Name it
      <code class="filename">oaw4.demo.emf.datamodel</code>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_defining_metamodel"></a>Defining the (meta)model</h3></div></div></div><p>Create a new source folder <code class="filename">metamodel</code> in that project. Then, create a
      new Ecore model in that source folder named
      <code class="filename">data.ecore</code>. Use <span class="type">EPackage</span> as the model
      object. </p><div class="figure"><a name="emf_tutorial_create_ecore_model"></a><p class="title"><b>Figure&nbsp;3.&nbsp;Create new Ecore model</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_ecore_model.jpg" alt="Create new Ecore model"></div></div></div><p><br class="figure-break">This opens the Ecore Editor. You will see a root package with
      name <code class="varname">null</code>. Open the Properties View (context menu).
      Set the following properties for the package: </p><div class="itemizedlist"><ul type="disc"><li>
             Name: data 
          </li><li>
             Ns prefix: data 
          </li><li>
             Ns URI: http://www.openarchitectureware.org/oaw4.demo.emf.datamodel 
          </li></ul></div><p> </p><div class="figure"><a name="emf_tutorial_adjust_namespace_settings"></a><p class="title"><b>Figure&nbsp;4.&nbsp;Adjust namespace settings</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_ecore_model_adjust_namespace.jpg" alt="Adjust namespace settings"></div></div></div><p><br class="figure-break"></p><p>Create the following Ecore model.<sup>[<a name="d0e189" href="#ftn.d0e189">1</a>]</sup> Make sure you set the following properties
      <span class="emphasis"><em>exactly</em></span> as described next:</p><p>Within the <span class="package">data</span> package, create these
      <code class="classname">EClass</code> elements with their attributes:<sup>[<a name="d0e207" href="#ftn.d0e207">2</a>]</sup></p><div class="informaltable"><a name="emf_tutorial_metamodel_attributes"></a><table cellspacing="0" cellpadding="10" border="0" style="border-collapse: collapse;border-bottom: 0.5pt solid ; "><colgroup><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EClass name</th><th style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EAttribute name</th><th style="border-bottom: 2 solid #000000; " align="left">EAttribute EType</th></tr></thead><tbody><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">DataModel</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">name</td><td style="border-bottom: 2 solid #000000; " align="left">EString</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Entity</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">name</td><td style="border-bottom: 2 solid #000000; " align="left">EString</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Attribute</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">name</td><td style="border-bottom: 2 solid #000000; " align="left">EString</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">type</td><td style="border-bottom: 2 solid #000000; " align="left">EString</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EntityReference</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">name</td><td style="border-bottom: 2 solid #000000; " align="left">EString</td></tr><tr><td style="border-right: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; " align="left">toMany</td><td style="" align="left">EBoolean</td></tr></tbody></table></div><p>Now, it is time to create references between the model elements.
      Add children of type <code class="classname">EReferences</code> as
      follows:<sup>[<a name="d0e286" href="#ftn.d0e286">3</a>]</sup></p><div class="informaltable"><a name="emf_tutorial_metamodel_references"></a><table cellspacing="0" cellpadding="10" width="100%" border="0" style="border-collapse: collapse;border-bottom: 0.5pt solid ; "><colgroup><col align="left"><col align="left"><col align="left"><col align="left"></colgroup><thead><tr><th style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EClass</th><th style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EReference name</th><th style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EReference attribute name</th><th style="border-bottom: 2 solid #000000; " align="left">EReference attribute value</th></tr></thead><tbody><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">DataModel</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">entity</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EType</td><td style="border-bottom: 2 solid #000000; " align="left">Entity</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">containment</td><td style="border-bottom: 2 solid #000000; " align="left">true</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Lowerbound</td><td style="border-bottom: 2 solid #000000; " align="left">0</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Upperbound</td><td style="border-bottom: 2 solid #000000; " align="left">-1</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Entity</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">attribute</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EType</td><td style="border-bottom: 2 solid #000000; " align="left">Attribute</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">containment</td><td style="border-bottom: 2 solid #000000; " align="left">true</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Lowerbound</td><td style="border-bottom: 2 solid #000000; " align="left">1</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Upperbound</td><td style="border-bottom: 2 solid #000000; " align="left">-1</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Entity</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">reference</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EType</td><td style="border-bottom: 2 solid #000000; " align="left">EntityReference</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">containment</td><td style="border-bottom: 2 solid #000000; " align="left">true</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Lowerbound</td><td style="border-bottom: 2 solid #000000; " align="left">0</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Upperbound</td><td style="border-bottom: 2 solid #000000; " align="left">-1</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EntityReference</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">target</td><td class="auto-generated" style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; ">&nbsp;</td><td class="auto-generated" style="border-bottom: 2 solid #000000; ">&nbsp;</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">EType</td><td style="border-bottom: 2 solid #000000; " align="left">Entity</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">containment</td><td style="border-bottom: 2 solid #000000; " align="left">false</td></tr><tr><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; border-bottom: 2 solid #000000; " align="left">Lowerbound</td><td style="border-bottom: 2 solid #000000; " align="left">1</td></tr><tr><td style="border-right: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; " align="left">&nbsp;</td><td style="border-right: 2 solid #000000; " align="left">Upperbound</td><td style="" align="left">1</td></tr></tbody></table></div><div class="figure"><a name="emf_tutorial_metamodel_structure"></a><p class="title"><b>Figure&nbsp;5.&nbsp;Metamodel structure</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_ecore_model_mm_structure.jpg" alt="Metamodel structure"></div></div></div><p><br class="figure-break"></p><p>EMF saves the model we created above in its own dialect of XMI. To
      avoid any ambiguities, here is the complete XMI source for the
      metamodel. It goes into the file <code class="filename">data.ecore</code>:
      </p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ecore:EPackage xmi:version="2.0"
		xmlns:xmi="http://www.omg.org/XMI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		xmlns:ecore="http://www.eclipse.org/emf/2002/Ecore" name="data"
		nsURI="http://www.openarchitectureware.org/oaw4.demo.emf.datamodel" nsPrefix="data"&gt;
	&lt;eClassifiers xsi:type="ecore:EClass" name="DataModel"&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EAttribute" name="name"
			eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString"/&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EReference" name="entity" upperBound="-1"
				eType="#//Entity" containment="true"/&gt;
	&lt;/eClassifiers&gt;
	&lt;eClassifiers xsi:type="ecore:EClass" name="Entity"&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EAttribute" name="name"
			eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString"/&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EReference" name="attribute" lowerBound="1"
				upperBound="-1" eType="#//Attribute" containment="true"/&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EReference" name="reference" upperBound="-1"
				eType="#//EntityReference" containment="true"/&gt;
	&lt;/eClassifiers&gt;
	&lt;eClassifiers xsi:type="ecore:EClass" name="Attribute"&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EAttribute" name="name"
			eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString"/&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EAttribute" name="type"
			eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString"/&gt;
	&lt;/eClassifiers&gt;
	&lt;eClassifiers xsi:type="ecore:EClass" name="EntityReference"&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EAttribute" name="name"
			eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EString"/&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EAttribute" name="toMany"
			eType="ecore:EDataType http://www.eclipse.org/emf/2002/Ecore#//EBoolean"/&gt;
		&lt;eStructuralFeatures xsi:type="ecore:EReference" name="target" lowerBound="1"
				eType="#//Entity"/&gt;
	&lt;/eClassifiers&gt;
&lt;/ecore:EPackage&gt;
</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_generate_emf_tooling"></a>Generating the EMF tooling</h2></div></div></div><p>In addition to providing the Ecore meta-meta-model, EMF also comes
    with support for building (more or less usable) editors. These are
    generated automatically from the metamodel we just defined. In order to
    define example models (which we will do below) we have to generate these
    editors. Also, we have to generate the implementation classes for our
    metamodel. To generate all these things, we have to define a markup model
    that contains a number of specifics to control the generation of the
    various artifacts. This markup model is called
    <span class="emphasis"><em>genmodel</em></span>.</p><p>So we have to define the <span class="emphasis"><em>genmodel</em></span> first. Select
    the <code class="filename">data.ecore</code> model in the explorer and right mouse
    click to <span class="guimenu">New</span> &#8594; <span class="guisubmenu">Other</span> &#8594; <span class="guisubmenu">Eclipse Modelling Framework</span> &#8594; <span class="guimenuitem">EMF Model</span>. Follow the following five steps; note that they are also
    illustrated in the next figure. </p><div class="orderedlist"><ol type="1"><li>
           Select EMF model 
        </li><li>
           Define the name 
        </li><li>
           Select the folder 
        </li><li>
           Select Ecore model as source 
        </li><li>
           Press the 

          <span class="emphasis"><em>Load</em></span>

           button and then 

          <span class="emphasis"><em>Finish</em></span></li></ol></div><p> </p><div class="figure"><a name="emf_tutorial_creating_genmodel"></a><p class="title"><b>Figure&nbsp;6.&nbsp;Creating the genmodel</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_ecore_genmodel_step_all_admonitions.jpg" alt="Creating the genmodel"></div></div></div><p><br class="figure-break"></p><p>As a consequence, you will get the finished EMF
    <span class="emphasis"><em>genmodel</em></span>. It is a kind of "wrapper" around the
    original metamodel, thus, it has the same structure, but the model
    elements have different properties. As of now, you do not have to change
    any of these. </p><div class="figure"><a name="emf_tutorial_structure_genmodel"></a><p class="title"><b>Figure&nbsp;7.&nbsp;Structure of the genmodel</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_ecore_genmodel_gm_structure.jpg" alt="Structure of the genmodel"></div></div></div><p><br class="figure-break"></p><p>You can now generate the other projects. </p><div class="figure"><a name="emf_tutorial_creating_editing_projects"></a><p class="title"><b>Figure&nbsp;8.&nbsp;Generate editing projects</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_ecore_genmodel_generate_all.jpg" alt="Generate editing projects"></div></div></div><p><br class="figure-break"></p><p>You now have all the generated additional projects. </p><div class="figure"><a name="emf_tutorial_generated_projects"></a><p class="title"><b>Figure&nbsp;9.&nbsp;Generated projects</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_ecore_genmodel_generated_projects.jpg" alt="Generated projects"></div></div></div><p><br class="figure-break"></p><p>We will not look any deeper at these additional projects for now.
    However, there is one important thing to point out: The generator also
    generated the implementation classes for the metamodel. If you take a look
    into <code class="filename">oaw4.demo.emf.datamodel/src</code>
    folder, you can find classes (actually, interfaces at the top level) that
    represent the concepts defined in your metamodel. These can be used to
    access the model. For some more details on how to use the EMF model APIs
    as well as the reflective cousins, take a look at <a xmlns:xlink="http://www.w3.org/1999/xlink" href="http://voelterblog.blogspot.com/2005/12/codeblogck-emf_10.html" target="_top">http://voelterblog.blogspot.com/2005/12/codeblogck-emf_10.html</a>.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_setting_generator_project"></a>Setting up the generator project</h2></div></div></div><p>In order to make it a bit less painless to work with Eclipse EMF (we
    would have to export the plugins, restart Eclipse, etc. etc.), we start
    another Eclipse in the IDE. This instance is called the <span class="emphasis"><em>Runtime
    Workbench</em></span>. Therefore select the
    <code class="filename">oaw4.demo.emf.datamodel.edit</code> project and choose from
    the context menu <span class="guimenu">Run As</span> &#8594; <span class="guimenuitem">Eclipse Application</span>. </p><div class="figure"><a name="emf_tutorial_launch_runtime_platform"></a><p class="title"><b>Figure&nbsp;10.&nbsp;Launch runtime platform</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/runas_eclipseapplication.jpg" alt="Launch runtime platform"></div></div></div><p><br class="figure-break"></p><p>If you are using a Mac or *nix you should now open the workspace
    preference page and change the default encoding to ISO-8859-1.<sup>[<a name="d0e591" href="#ftn.d0e591">4</a>]</sup>Import the <code class="filename">oaw4.demo.emf.datamodel</code>
    project from your original workspace.<sup>[<a name="d0e612" href="#ftn.d0e612">5</a>]</sup> Note that importing the project does not physically move the
    files,<sup>[<a name="d0e624" href="#ftn.d0e624">6</a>]</sup> so you can have the project be part of both workspaces at
    the same time.</p><p>Create a new openArchitectureWare Project<sup>[<a name="d0e630" href="#ftn.d0e630">7</a>]</sup> called <code class="filename">oaw4.demo.emf.datamodel.generator</code>. Do not
    choose the option "Generate a simple example". </p><div class="figure"><a name="emf_tutorial_create_new_oaw_project"></a><p class="title"><b>Figure&nbsp;11.&nbsp;Create new oAW project</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_new_oaw_project.jpg" alt="Create new oAW project"></div></div></div><p><br class="figure-break"></p><p>Your openArchitectureWare project will already be configured for use
    of EMF models. You can check this in the project properties dialog:
    </p><div class="figure"><a name="emf_tutorial_project_properties"></a><p class="title"><b>Figure&nbsp;12.&nbsp;Project properties</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/oaw_project_properties.jpg" alt="Project properties"></div></div></div><p><br class="figure-break"></p></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_defining_sample_model"></a>Defining an Example Data Model</h2></div></div></div><p>Select the <code class="filename">src</code> folder and
    then choose <span class="guimenu">New</span> &#8594; <span class="guisubmenu">Other</span> &#8594; <span class="guisubmenu">Example EMF Model Creation Wizards</span> &#8594; <span class="guimenuitem">Data Model</span>. Create a new data model, call it
    <code class="filename">example.data</code>. On the last page of the wizard, select
    <span class="emphasis"><em>Model</em></span> as model object. </p><div class="figure"><a name="emf_tutorial_create_sample_data_model"></a><p class="title"><b>Figure&nbsp;13.&nbsp;Create a sample data model</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/create_data_model.jpg" alt="Create a sample data model"></div></div></div><p><br class="figure-break"></p><p>Next, populate this very model as following. Please note that in the
    case of attributes you have to define a type as well (i.e. String), not
    just a name. </p><div class="figure"><a name="emf_tutorial_sample_data_model"></a><p class="title"><b>Figure&nbsp;14.&nbsp;Sample data model</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/sample_datamodel.jpg" alt="Sample data model"></div></div></div><p><br class="figure-break"></p><p>Again, to avoid any typos here is the XMI for
    <code class="filename">example.data</code>:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;data:DataModel
	xmi:version="2.0"
	xmlns:xmi="http://www.omg.org/XMI"
	xmlns:data="http://www.openarchitectureware.org/oaw4.demo.emf.datamodel"&gt;
	&lt;entity name="Person"&gt;
		&lt;attribute name="name" type="String"/&gt;
		&lt;reference name="autos" toMany="true" target="//@entity.1"/&gt;
	&lt;/entity&gt;
	&lt;entity name="Vehicle"&gt;
		&lt;attribute name="plate" type="String"/&gt;
	&lt;/entity&gt;
&lt;/data:DataModel&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_dynamic_emf"></a>Using Dynamic EMF</h2></div></div></div><p>Instead of generating editors and metaclasses, you can also use
    dynamic EMF. This works by selecting, in the opened metamodel, the root
    class of the model you want to create (here:
    <span class="emphasis"><em>DataModel</em></span>) and then selecting  from the context menu. This opens an editor that can
    dynamically edit the respective instance. The created file by default has
    an <code class="filename">.xmi</code> extension.</p><p>Note that openArchitectureWare can work completely with dynamic
    models, there is no reason to generate code. However, if you want to
    programmatically work with the model, the generated metaclasses (not the
    editors!) are really helpful. Please also keep in mind: in subsequent
    parts of the tutorial, you will specify the
    <span class="emphasis"><em>metaModelPackage</em></span> in various component configurations
    in the workflow file, like this:</p><pre class="programlisting">&lt;metaModel id="mm"
  class="org.openarchitectureware.type.emf.EmfMetaModel"&gt;
  &lt;metaModelPackage value="data.DataPackage"/&gt;
&lt;/metaModel&gt;
</pre><p>In case of dynamic EMF, there has no metamodel package been
    generated. So, you have to specify the metamodel file instead, that is,
    the <code class="filename">.ecore</code> file you just created. Note that the
    <code class="filename">.ecore</code> file has to be in the classpath to make this
    work.</p><pre class="programlisting">&lt;metaModel id="mm"
  class="org.openarchitectureware.type.emf.EmfMetaModel"&gt;
  &lt;metaModelFile value="data.ecore"/&gt;
&lt;/metaModel&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_generating_code"></a>Generating code from the example model</h2></div></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_the_workflow_definition"></a>The workflow definition</h3></div></div></div><p>To run the openArchitectureWare generator, you have to define a
      workflow. It controls which steps (loading models, checking them,
      generating code) the generator executes. For details on how workflow
      files work, please take a look at the <span class="emphasis"><em>Workflow Reference
      Documentation</em></span>.</p><p>Create a <code class="filename">workflow.oaw</code> and a
      <code class="filename">workflow.properties</code> in the <code class="filename">src</code> folder. The contents of these files is
      shown below:</p><pre class="programlisting">&lt;workflow&gt;
  &lt;property file="workflow.properties"/&gt;

  &lt;component id="xmiParser"
    class="org.openarchitectureware.emf.XmiReader"&gt;
    &lt;modelFile value="${modelFile}"/&gt;
    &lt;metaModelPackage value="data.DataPackage"/&gt;
    &lt;outputSlot value="model"/&gt;
    &lt;firstElementOnly value="true"/&gt;
  &lt;/component&gt;
&lt;/workflow&gt;</pre><p><code class="code">workflow.properties</code>:</p><pre class="programlisting">modelFile=example.data
srcGenPath=src-gen
fileEncoding=ISO-8859-1</pre><p>The workflow tries to load stuff from
      the classpath; so, for example, the
      <code class="classname">data.DataPackage</code> class is resolved from the
      classpath, as is the model file specified in the properties
      (<code class="filename">modelFile=example.data</code>)</p><p>This instantiates the example model and stores in a workflow slot
      named model. Note that in the <span class="emphasis"><em>metamodelPackage</em></span>
      slot, you have to specify the EMF package object (here:
      <code class="classname">data.DataPackage</code>), not the Java package (which
      would be <span class="package">data</span> here).</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_running_the_workflow"></a>Running the workflow</h3></div></div></div><p>Before you actually run the workflow, make sure you have a log4j
      configuration in the classpath; for example, you can put the following
      <code class="filename">log4j.properties</code> file directly into your source
      folder:</p><pre class="programlisting"># Set root logger level to DEBUG and its only appender to A1.
log4j.rootLogger=INFO, A1

# A1 is set to be a ConsoleAppender.
log4j.appender.A1=org.apache.log4j.ConsoleAppender
log4j.appender.A1.layout=org.apache.log4j.PatternLayout
log4j.appender.A1.layout.ConversionPattern=%-4r %-5p - %m%n
</pre><p>Also, please make sure your metamodel can be found on the
      classpath. In our case, this can be achieved by adding the
      <code class="filename">oaw4.demo.emf.datamodel</code> project to the plug-in
      dependencies of <code class="filename">oaw4.demo.emf.datamodel.generator</code>.
      To do this, double click the file
      <code class="filename">oaw4.demo.emf.datamodel.generator/META-INF/MANIFEST.MF</code>.
      The manifest editor will appear. Go to the
      <span class="guimenu">Dependencies</span> tab and click on
      <span class="guimenu">Add...</span> to add a new dependency. In the dialog
      appearing, choose <code class="filename">oaw3.demo.emf.datamodel</code>: </p><div class="figure"><a name="emf_tutorial_add_metamodel_dependency"></a><p class="title"><b>Figure&nbsp;15.&nbsp;Add metamodel dependency</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/add_metamodel_to_classpath.jpg" alt="Add metamodel dependency"></div></div></div><p><br class="figure-break"> Do not forget to save the manifest file!</p><p>Now, you can run the workflow from within Eclipse: </p><div class="figure"><a name="emf_tutorial_sample_data_model_2"></a><p class="title"><b>Figure&nbsp;16.&nbsp;Sample data model</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/run_workflow.jpg" alt="Sample data model"></div></div></div><p><br class="figure-break"></p><p>The following should be the output:</p><pre class="screen">0    INFO  - --------------------------------------------------------------------------------------
171  INFO  - openArchitectureWare 4.1.2, Build v20070314
171  INFO  - (c) 2005-2007 openarchitectureware.org and contributors
171  INFO  - --------------------------------------------------------------------------------------
171  INFO  - running workflow: D:/oAW-emftutorial/oaw4.demo.emf.datamodel.generator/src/workflow.oaw
171  INFO  -
750  INFO  - xmiParser: file 'example.data' =&gt; slot 'model'
875  INFO  - workflow completed in 125ms!</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_templates"></a>Templates</h3></div></div></div><p>No code is generated yet. This is not surprising, since we did not
      yet add any templates. Let us change this. Create a package
      <span class="package">templates</span> in the <code class="filename">src</code>folder and within the package a file
      called <code class="filename">Root.xpt</code>.</p><p>The <code class="filename">Root.xpt</code> looks as follows. By the way, if
      you need to type the <span class="foreignphrase"><em class="foreignphrase">guillemets</em></span> (&laquo; and
      &raquo;), the editor provides keyboard shortcuts with <span><strong class="keycap">Ctrl</strong></span>+<span><strong class="keycap">&lt;</strong></span> and <span><strong class="keycap">Ctrl</strong></span>+<span><strong class="keycap">&gt;</strong></span>.</p><pre class="programlisting">&laquo;DEFINE Root FOR data::DataModel&raquo;
  &laquo;EXPAND Entity FOREACH entity&raquo;
&laquo;ENDDEFINE&raquo;

&laquo;DEFINE Entity FOR data::Entity&raquo;
	&laquo;FILE name + ".java"&raquo;
		public class &laquo;name&raquo; {
			&laquo;FOREACH attribute AS a&raquo;
				// bad practice
				private &laquo;a.type&raquo; &laquo;a.name&raquo;;
			&laquo;ENDFOREACH&raquo;
		}
	&laquo;ENDFILE&raquo;
&laquo;ENDDEFINE&raquo; </pre><p>We have to extend the <code class="filename">workflow.oaw</code> file, in
      order to use the template just written:</p><pre class="programlisting">&lt;?xml version="1.0" encoding="windows-1252"?&gt;
&lt;workflow&gt;
	&lt;property file="workflow.properties"/&gt;

	&lt;component id="xmiParser"
		class="org.openarchitectureware.emf.XmiReader"&gt;
		...
	&lt;/component&gt;
</pre><p>First, we clean up the directory where we want to put the
      generated code.</p><pre class="programlisting">	&lt;component id="dirCleaner"
		class="org.openarchitectureware.workflow.common.DirectoryCleaner" &gt;
		&lt;directories value="${srcGenPath}"/&gt;
	&lt;/component&gt;</pre><p>Then, we start the generator component. Its configuration is
      slightly involved.</p><pre class="programlisting">	&lt;component id="generator"
		class="org.openarchitectureware.xpand2.Generator"&gt;
</pre><p>First of all, you have to define the metamodel. In our case, we
      use the <code class="classname">EmfMetaModel</code> since we want to work with
      EMF models. Also, you have to specific the class name of the EMF package
      that represents that metamodel. It has to be on the classpath.</p><pre class="programlisting">		&lt;metaModel id="mm"
			class="org.openarchitectureware.type.emf.EmfMetaModel"&gt;
			&lt;metaModelPackage value="data.DataPackage"/&gt;
		&lt;/metaModel&gt;</pre><p>Then, you have to define the <span class="emphasis"><em>entry statement</em></span>
      for <span class="emphasis"><em>Xpand</em></span>. Knowing that the model slot contains an
      instance of <code class="classname">data.DataModel</code> (the XMIReader had put
      the first element of the model into that slot, and we know from the data
      that it is a <code class="classname">DataModel</code>), we can write the
      following statement. Again, notice that model refers to a slot name
      here!</p><pre class="programlisting">		&lt;expand value="templates::Root::Root FOR model"/&gt;</pre><p>We then specify where the generator should put the generated code
      and that this generated code should be processed by a code
      beautifier:</p><pre class="programlisting">		&lt;outlet path="${srcGenPath}/"&gt;
			&lt;postprocessor
				class="org.openarchitectureware.xpand2.output.JavaBeautifier"/&gt;
		&lt;/outlet&gt;</pre><p>Now, we are almost done.</p><pre class="programlisting">	&lt;/component&gt;
&lt;/workflow&gt;</pre><p>You also need to add the <span class="emphasis"><em>srcGenPath</em></span> to the
      <code class="filename">workflow.properties</code> file.</p><pre class="programlisting">modelFile=example.data
srcGenPath=src-gen</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_running_the_generator_again"></a>Running the generator again</h3></div></div></div><p>So, if you restart the generator now, you should get a file
      generated that looks like this:</p><pre class="programlisting">public class Person {
	// bad practice
	public String lastName;
}</pre></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_checking_contraints_with_check"></a>Checking Constraints with the <span class="emphasis"><em>Check</em></span>
    Language</h2></div></div></div><p>An alternative to checking constraints with pure Java, is the
    declarative constraint checking language <span class="emphasis"><em>Check</em></span>. For
    details of this language take a look at the <span class="emphasis"><em><a href="core_reference.html#Check_language" title="Check">Check language</a></em></span> reference. We will provide a simple
    example here.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_defining_the_constraint"></a>Defining the constraint</h3></div></div></div><p>We start by defining the constraint itself. We create a new file
      called <code class="filename">checks.chk</code> in the <code class="filename">src</code> folder of our project. It is important
      that this file resides in the classpath! The file has the following
      content:</p><pre class="programlisting">import data;
context Attribute ERROR
	 "Names must be more than one char long" :
	 name.length &gt; 1;</pre><p>This constraint says that for the metaclass
      <code class="classname">data::Attribute</code>, we require that the name be more
      than one characters long. If this expression evaluates to false, the
      error message given before the colon will be reported. A checks file can
      contain any number of such constraints. They will be evaluated for all
      instances of the respective metaclass.</p><p>To show a somewhat more involved constraint example, this one
      ensures that the names of the attributes have to be unique:</p><pre class="programlisting">context Entity ERROR
	"Names of Entity attributes must be unique":
	attribute.forAll(a1| attribute.notExists(a2| a1 != a2 &amp;&amp; a1.name == a2.name ) );</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_integration_into_the_workflow_file"></a>Integration into the workflow file</h3></div></div></div><p>The following piece of XML is the workflow file we have already
      used above.</p><pre class="programlisting">&lt;?xml version="1.0" encoding="windows-1252"?&gt;
&lt;workflow&gt;
	&lt;property file="workflow.properties"/&gt;

	&lt;component id="xmiParser" class="org.openarchitectureware.emf.XmiReader"&gt;
		...
	&lt;/component&gt;</pre><p>After reading the model, we add an additional component, namely
      the <span class="emphasis"><em>CheckComponent</em></span>.</p><pre class="programlisting">	&lt;component
		class="org.openarchitectureware.check.CheckComponent"&gt;</pre><p>As with the code generator, we have to explain to the checker what
      meta-meta-model and which metamodel we use.</p><pre class="programlisting">		&lt;metaModel id="mm" class="org.openarchitectureware.type.emf.EmfMetaModel"&gt;
			&lt;metaModelPackage value="data.DataPackage"/&gt;
		&lt;/metaModel&gt;</pre><p>We then have to provide the checks file. The component tries to
      load the file by appending <code class="filename">.chk</code> to the name and
      searching the classpath &#8211; that is why it has to be located in the
      classpath.</p><pre class="programlisting">		&lt;checkFile value="checks"/&gt;</pre><p>Finally, we have to tell the engine on which model or part of the
      model the checks should work. In general, you can use the
      <code class="code">&lt;expressionvalue="..."/&gt;</code> element to define an
      arbitrary expression on slot contents. For our purpose, where we want to
      use the complete EMF data structure in the model slot, we can use the
      shortcut <span class="emphasis"><em>emfAllChildrenSlot</em></span> property, which returns
      the complete subtree below the content element of a specific slot,
      including the slot content element itself.</p><pre class="programlisting">		&lt;emfAllChildrenSlot value="model"/&gt;
	&lt;/component&gt;</pre><p>Running the workflow produces an error in case the length of the
      name is not greater than one. Again, it makes sense to add the
      <code class="code">skipOnError="true"</code> to those subsequent component
      invocations that need to be skipped in case the constraint check found
      errors (typically code generators or transformers).</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_extensions"></a>Extensions</h2></div></div></div><p>It is often the case that you need additional properties in the
    templates; these properties should not be added to the metaclasses
    directly, since they are often specific to the specific code generation
    target and thus should not "pollute" the metamodel.</p><p>It is possible to define such extensions external to the
    metaclasses. For details see the <span class="emphasis"><em>Xtend Language
    Documentation</em></span>, we provide an simple example here.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_expression_extensions"></a>Expression Extensions</h3></div></div></div><p>Assume we wanted to change the <span class="emphasis"><em>Attribute</em></span>s
      part of the template as follows:</p><pre class="programlisting">&laquo;FOREACH attribute AS a&raquo;
	private &laquo;a.type&raquo; &laquo;a.name&raquo;;

	public void &laquo;a.setterName()&raquo;( &laquo;a.type&raquo; value ) {
		this.&laquo;a.name&raquo; = value;
	}

	public &laquo;a.type&raquo; &laquo;a.getterName()&raquo;() {
		return this.&laquo;a.name&raquo;;
	}
&laquo;ENDFOREACH&raquo;</pre><p>To make this work, we need to define the
      <code class="methodname">setterName()</code> and
      <code class="methodname">getterName()</code> operations. We do this by writing
      a so-called extension file; we call it <code class="filename">java.ext</code>. It
      must have the <code class="filename">.ext</code> suffix to be recognized by oAW;
      the <span class="emphasis"><em>Java</em></span> name is because it contains
      Java-generation specific properties. We put this file directly into the
      <code class="filename">templates</code> directory under
      <code class="filename">src</code>, i.e. directly next to the
      <code class="filename">Root.xpt</code> file. The extension file looks as
      follows:</p><p>First, we have to import the data metamodel; otherwise we would
      not be able to use the <span class="emphasis"><em>Attribute</em></span> metaclass.</p><pre class="programlisting">import data;</pre><p>We can then define the two new operations
      <code class="methodname">setterName</code> and
      <code class="methodname">getterName</code>. Note that they take the type on
      which they are called as their first parameter, a kind of "explicitly
      this". After the colon we use an expression that returns the
      to-be-defined value.</p><pre class="programlisting">String setterName(Attribute ele) :
	'set'+ele.name.toFirstUpper();

String getterName(Attribute ele) :
	'get'+ele.name.toFirstUpper();</pre><p>To make these extensions work, we have to add the following line
      to the beginning of the <code class="filename">Root.xpt</code> template
      file:</p><pre class="programlisting">&laquo;EXTENSION templates::java&raquo;</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_java_extensions"></a>Java Extensions</h3></div></div></div><p>In case you cannot express the "business logic" for the expression
      with the expression language, you can fall back to Java. Take a loot at
      the following extension definition file. It is called
      <code class="filename">util.ext</code> and is located in <code class="filename">src/datamodel/generator/util</code>:</p><pre class="programlisting">String timestamp() :
	JAVA datamodel.generator.util.TemplateUtils.timestamp();</pre><p>Here, we define an extension that is independent of a specific
      model element, since it does not have a formal parameter! The
      implementation of the extension is delegated to a static operation of a
      Java class. Here is its implementation:</p><pre class="programlisting">public class TemplateUtils {
	public static String timestamp() {
		return String.valueOf( System.currentTimeMillis() );
	}
}</pre><p>This element can be used independent of any model element &#8211; it is
      available globally.</p><p>Sometimes, it is necessary to access extensions not just from
      templates (and Wombat scripts) but also from Java code. The following
      example is of this kind: We want to define properties that derive the
      name of the implementation class from the entity name itself; we will
      need that property in the next section, the one on recipes. The best
      practice for this use case is to implement the derived property as a
      Java method, as above. The following piece of code declares properties
      for <code class="classname">Entity</code>:</p><pre class="programlisting">package datamodel;

import data.Entity;

public class EntityHelper {

	public static String className( Entity e ) {
		return e.getName()+"Implementation";
	}

	public static String classFileName( Entity e ) {
		return className(e)+".java";
	}

}</pre><p>In addition, to access the properties from the template files, we
      define an extension that uses the helper methods. The
      <code class="filename">helper.ext</code> file is located right next to the helper
      class shown above, i.e. in the <span class="package">datamodel</span>
      package:</p><pre class="programlisting">import data;

String className( Entity e ) :
	 JAVA datamodel.EntityHelper.className(data.Entity);

String classFileName( Entity e ) :
	 JAVA datamodel.EntityHelper.classFileName(data.Entity);</pre><p>In addition to these new properties being accessible from Java
      code by invoking <code class="code">EntityHelper.className(someEntity)</code>, we can
      now write the following template:</p><pre class="programlisting">&laquo;EXTENSION templates::java&raquo;
&laquo;EXTENSION datamodel::generator::util::util&raquo;
&laquo;EXTENSION datamodel::helper&raquo;

&laquo;DEFINE Root FOR data::DataModel&raquo;
	&laquo;EXPAND Entity FOREACH entity&raquo;
&laquo;ENDDEFINE&raquo;

&laquo;DEFINE Entity FOR data::Entity&raquo;
	&laquo;FILE classFileName()&raquo;
		// generated at &laquo;timestamp()&raquo;
		public abstract class &laquo;className()&raquo; {
			&laquo;FOREACH attribute AS a&raquo;
				private &laquo;a.type&raquo; &laquo;a.name&raquo;;
				public void &laquo;a.setterName()&raquo;( &laquo;a.type&raquo; value ) {
					this.&laquo;a.name&raquo; = value;
				}

				public &laquo;a.type&raquo; &laquo;a.getterName()&raquo;() {
					return this.&laquo;a.name&raquo;;
				}
			&laquo;ENDFOREACH&raquo;
		}
	&laquo;ENDFILE&raquo;
&laquo;ENDDEFINE&raquo;</pre><p>For completeness, the following illustration shows the resulting
      directory and file structure. </p><div class="figure"><a name="emf_tutorial_what_happened_so_far"></a><p class="title"><b>Figure&nbsp;17.&nbsp;What has happened so far</b></p><div class="figure-contents"><div class="mediaobject"><img src="images/emf_tutorial/generator_structure_so_far.jpg" alt="What has happened so far"></div></div></div><p><br class="figure-break"></p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_integrating_recipes"></a>Integrating Recipes</h2></div></div></div><p>Let us assume, we wanted to allow developers to add their own
    business logic to the entities, maybe adding a couple of derived
    properties. In that case, we have to integrate the generated code with
    manually written fragments. Let us further assume that you &#8211; just like me
    &#8211; do not like protected regions because the end up in versioning chaos. In
    such case, you might want to let the generator create a base class that
    contains all generated aspects and developers have to inherit from this
    class to add their own logic. Let us first change the generator
    accordingly.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_add_recipe_dependency"></a>Adjusting project settings</h3></div></div></div><p>We will now use the Recipe framework of openArchitectureWare to
      achieve our task. Since this framework is an add-on we need to set up an
      additional dependency to it for our generator project. Otherwise the
      required classes will not be found.</p><p>Open the projects Manifest file
      <code class="filename">META-INF/MANIFEST.MF</code>, go to the
      <span class="emphasis"><em>Dependencies</em></span> page and add the
      <span class="package">org.openarchitectureware.recipe.*</span> plugins.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_adapting_the_generator"></a>Adapting the existing generator</h3></div></div></div><p>First, let us look at the template. Here we have to change the
      name of the generated class, and we have to make it abstract:</p><pre class="programlisting">&laquo;DEFINE Entity FOR data::Entity&raquo;
	&laquo;FILE baseClassFileName()&raquo;
			// generated at &laquo;timestamp()&raquo;
				 public abstract class &laquo;baseClassName()&raquo; {

			&laquo;FOREACH attribute AS a&raquo;
												...
			&laquo;ENDFOREACH&raquo;
		}
	&laquo;ENDFILE&raquo;
&laquo;ENDDEFINE&raquo;</pre><p>To make this work, our extensions must be adapted; we now need
      <code class="methodname">baseClassName</code> and
      <code class="methodname">baseClassFileName</code>.</p><pre class="programlisting">import data;

String baseClassName( Entity e ) :
	 JAVA datamodel.EntityHelper.baseClassName(data.Entity);

String baseClassFileName( Entity e ) :
	 JAVA datamodel.EntityHelper.baseClassFileName(data.Entity);</pre><p>The implementation helper class must be adapted, too:</p><pre class="programlisting">package datamodel;

import data.Entity;

public class EntityHelper {

	public static String baseClassName( Entity e ) {
		return e.getName()+"ImplBase";
	}

	public static String baseClassFileName( Entity e ) {
		return baseClassName(e)+".java";
	}

	public static String implementationClassName( Entity e ) {
		return e.getName();
	}

}</pre><p>Note the additional property
      <code class="methodname">implementationClassName</code>. This is the name of
      the class that developers have to write manually. While we expect that
      the generated code goes into the <code class="filename">src-gen</code> directory, we want the manually
      written code in <code class="filename">man-src</code>. Here is
      the generated base class for the <code class="classname">Person</code>
      entity:</p><pre class="programlisting">// generated at 1138622360609
public abstract class PersonImplBase {
		private String name;

		public void setName(String value) {
				this.name = value;
		}

		public String getName() {
				return this.name;
		}
}</pre><p>The manually written subclass could look as follows:</p><pre class="programlisting">public class Person extends PersonImplBase {

}</pre><p>Now, here is the issue: how do you make sure that developers
      actually write this class, that it has the right name, and that it
      actually extends the generated base class? This is where the recipe
      framework comes into play. We want to define rules that allow Eclipse to
      verify that these "programming guidelines" have been met by
      developers.</p></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_implementing_recipes"></a>Implementing the Recipes</h3></div></div></div><p>As of now, there is no specific language to implement those recipe
      checks, you have to write a bunch of Java code. In summary, you have to
      implement a workflow component that produces the checks. Let us look at
      what you need to do.</p><p>In order to simplify life, your recipe creation component should
      use the <code class="classname">RecipeCreationComponent</code> base
      class.</p><pre class="programlisting">public class RecipeCreator extends RecipeCreationComponent {</pre><p>You then have to override the createRecipes operation.</p><pre class="programlisting">	protected Collection createRecipes(Object modelSlotContent,
		String appProject, String srcPath) {</pre><p>We now create a list that we use to collect all the checks we want
      to pass back to the framework.</p><pre class="programlisting">		List checks = new ArrayList();</pre><p>Since we need to implement such a check for each Entity in the
      model, we have to find all entities and iterate over them.</p><pre class="programlisting">		Collection entities = EcoreUtil2.findAllByType(
			((DataModel)modelSlotContent).eAllContents(),
			Entity.class );
		for (Iterator iter = entities.iterator(); iter.hasNext();) {
			Entity e = (Entity) iter.next();</pre><p>We then create a composite check whose purpose is to act as a
      container for the more specific checks that follow. It will show as the
      root of a tree in the Recipe Framework view.</p><pre class="programlisting">			ElementCompositeCheck ecc = new ElementCompositeCheck(e,
				"manual implementation of entity");</pre><p>Then we add a check that verifies the existence of a certain class
      in a given project in a certain directory. The name of the class it
      needs to check for can be obtained from our EntityHelper!</p><pre class="programlisting">			JavaClassExistenceCheck javaClassExistenceCheck =
				new JavaClassExistenceCheck(
					"you have to provide an implementation class.",
					appProject, srcPath,
					EntityHelper.implementationClassName(e)
				);</pre><p>We then define a second check that checks that the class whose
      existence has been verified with the check above actually inherits from
      the generated base class. Again we use the
      <code class="classname">EntityHelper</code> to come up with the names. Note that
      they will be consistent with the names used in the code generation
      templates because both use the same <code class="classname">EntityHelper</code>
      implementation.</p><pre class="programlisting">			JavaSupertypeCheck javaSuperclassCheck =
				new JavaSupertypeCheck(
					"the implementation class has to extend the "+
					"generated base class", appProject,
					EntityHelper.implementationClassName(e),
					EntityHelper.baseClassName(e)
				);</pre><p>We then add the two specific checks to the composite
      check...</p><pre class="programlisting">			ecc.addChild( javaClassExistenceCheck );
			ecc.addChild( javaSuperclassCheck );</pre><p>... add the composite check to the list of checks we return to the
      framework, ...</p><pre class="programlisting">			checks.add( ecc );
		}</pre><p>... and return all the created checks to the framework after we
      finish iteration over <code class="classname">Entities</code>:</p><pre class="programlisting">		return checks;
	}
}</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_workflow_integration"></a>Workflow Integration</h3></div></div></div><p>Here is the modified workflow file. We integrate our new component
      as the last step in the workflow.</p><pre class="programlisting">[&lt;?xml version="1.0" encoding="windows-1252"?&gt;
&lt;workflow&gt;
	&lt;property file="workflow.properties"/&gt;

	&lt;component id="xmiParser"
		class="org.openarchitectureware.emf.XmiReader"&gt;
		&lt;modelFile value="${modelFile}"/&gt;
		&lt;metaModelPackage value="data.DataPackage"/&gt;
		&lt;outputSlot value="model"/&gt;
		&lt;firstElementOnly value="true"/&gt;
	&lt;/component&gt;

	&lt;!-- all the stuff from before --&gt;</pre><p>The parameters we pass should be self-explanatory. The
      <em class="parameter"><code>recipeFile</code></em> parameter is where the checks will
      written to &#8211; it must have the <code class="filename">recipes</code>
      extension.</p><pre class="programlisting">	&lt;component id="recipe"
									 class="datamodel.generator.RecipeCreator"&gt;
		&lt;appProject value="oaw4.demo.emf.datamodel.generator"/&gt;
		&lt;srcPath value="man-src"/&gt;
		&lt;modelSlot value="model"/&gt;
		&lt;recipeFile value="recipes.recipes"/&gt;
	&lt;/component&gt;

&lt;/workflow&gt;
</pre></div><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_running_workflow_with_recipes"></a>Running the Workflow and seeing the Effect</h3></div></div></div><p>We can now run the workflow. After running it, you should see a
      <code class="filename">recipes.recipes</code> file in the root of your project.
      Right clicking on it reveals the  button. Since the manual implementation of the
      <code class="classname">Vehicle</code> Entity is missing, we get the respective
      error.</p><p>We can now implement the class manually, in the <code class="filename">man-src</code> folder:</p><pre class="programlisting">public class Vehicle extends VehicleImplBase {
}</pre><p>After doing that, the remaining errors in the recipe view should
      go away automatically.</p></div></div><div class="section" lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="emf_tutorial_transforming_models"></a>Transforming Models</h2></div></div></div><p>It is often necessary to transform models before generating code
    from it. There are actually two forms of transformations:</p><div class="orderedlist"><ol type="1"><li><p>An actual model <span class="emphasis"><em>transformation</em></span> generates a
        completely new model &#8211; usually based on a different metamodel &#8211; from
        an input model. The transformation has no side effects with respect to
        the input model.</p></li><li><p>A model <span class="emphasis"><em>modification</em></span>
        completes/extends/finishes/modifies a model. No additional model is
        created.</p></li></ol></div><p>Please take a look at the <span class="emphasis"><em>xTend Example
    tutorial</em></span> to understand model transformations with the xTend
    language.</p><div class="section" lang="en"><div class="titlepage"><div><div><h3 class="title"><a name="emf_tutorial_model_modifications"></a>Model Modifications in Java</h3></div></div></div><p>One way of doing modifications is to use Java. Take a look at the
      following piece of Java code. We extend from a class called
      <code class="classname">SimpleJavaTransformerComponent</code>. Instead of
      directly implementing the <code class="classname">WorkflowComponent</code>
      interface, we inherit from a more comfortable base class and implement
      the <code class="methodname">doModification</code> operation.</p><pre class="programlisting">public class Transformer extends SimpleJavaModificationComponent {

	protected void doModification(WorkflowContext ctx, ProgressMonitor
		monitor, Issues issues, Object model) {</pre><p>We know that we have a <code class="classname">DataModel</code> object in
      the model slot (you can see in a moment where the model comes
      from).</p><pre class="programlisting">		DataModel dm = (DataModel)model;</pre><p>We then get us the factory to create new model elements (what this
      code does exactly you should learn from the EMF docs).</p><pre class="programlisting">		DataFactory f = DataPackage.eINSTANCE.getDataFactory();</pre><p>We then iterate over all entities.</p><pre class="programlisting">		for (Iterator iter = dm.getEntity().iterator(); iter.hasNext();) {
			Entity e = (Entity) iter.next();
			handleEntity(e, f);
		}
	}</pre><p>For each <code class="classname">Entity</code>...</p><pre class="programlisting">	private void handleEntity(Entity e, DataFactory f) {
		for (Iterator iter = EcoreUtil2.clone( e.getAttribute() ).iterator(); iter.hasNext();) {
			Attribute a = (Attribute) iter.next();</pre><p>We create a new attribute with the same type, and a name with a
      "2" postfixed. We then add this new attribute to the entity.</p><pre class="programlisting">			Attribute a2 = f.createAttribute();
			a2.setName( a.getName()+"2" );
			a2.setType( a.getType() );
			e.getAttribute().add(a2);
		}
	}
}</pre><p>To execute this component, we just have to add it to the
      workflow:</p><pre class="programlisting">[&lt;component class="datamodel.generator.Transformer"&gt;
	&lt;modelSlot value="model"/&gt;
&lt;/component&gt;</pre><p>We have to specify the model slot. The superclass
      (<code class="classname">SimpleJavaTransformerComponent</code>) provides the
      slot setter and passes the object from that slot to the
      <code class="methodname">doTransform</code> operation.</p></div></div><div class="footnotes"><br><hr width="100" align="left"><div class="footnote"><p><sup>[<a name="ftn.d0e189" href="#d0e189">1</a>] </sup>To add children, right-click on the element to which you want
          to add these children and select the type of the child from the
          list. To configure the properties, open the properties dialog by
          selecting <span class="guimenu">Show Properties View</span> at the bottom of
          any of the context menus. Note that this is not an EMF tutorial. For
          more details on how to build EMF (meta-)models, please refer to the
          EMF documentation.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e207" href="#d0e207">2</a>] </sup>Attributes are children of type
          <code class="classname">EAttribute</code>. Please fill in the
          <span class="property">Name</span> and the <span class="property">EType</span>
          properties.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e286" href="#d0e286">3</a>] </sup>Note: there are a couple of <span class="emphasis"><em>-1's</em></span> ...
          don't miss the minus! Also, the containment flag is essential. If
          containment is <code class="literal">true</code> you will be able to create
          children of the referenced type, otherwise you can only reference
          them.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e591" href="#d0e591">4</a>] </sup><span class="guimenu">Window</span> &#8594; <span class="guisubmenu">Preferences</span> &#8594; <span class="guisubmenu">General</span> &#8594; <span class="guisubmenu">Workspace</span> &#8594; <span class="guimenuitem">Text file encoding</span>. This is necessary to have the
        <span class="foreignphrase"><em class="foreignphrase">guillemet</em></span> brackets available.</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e612" href="#d0e612">5</a>] </sup><span class="guimenu">File</span> &#8594; <span class="guisubmenu">Import</span> &#8594; <span class="guisubmenu">General</span> &#8594; <span class="guimenuitem">Existing Project into Workspace</span></p></div><div class="footnote"><p><sup>[<a name="ftn.d0e624" href="#d0e624">6</a>] </sup>Unless you checked the option "Copy projects into
        workspace"</p></div><div class="footnote"><p><sup>[<a name="ftn.d0e630" href="#d0e630">7</a>] </sup><span class="guimenu">File</span> &#8594; <span class="guisubmenu">New</span> &#8594; <span class="guisubmenu">Project</span> &#8594; <span class="guisubmenu">openArchitectureWare</span> &#8594; <span class="guimenuitem">openArchitectureWare Project</span></p></div></div></div></body></html>